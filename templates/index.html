{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}


<nav class="nabar">
    <div class="navbar-brand">
        <i class="fas fa-heartbeat"></i>
        <span>Smart Care</span>
    </div>
    
    <div class="navbar-menu">
        <a href="{{ url_for('dashboard') }}" class="active">
            <i class="fas fa-home"></i> Dashboard
        </a>
        {% if user_role == 'doctor' %}
        <a href="#patients">
            <i class="fas fa-procedures"></i> Patients
        </a>
        {% endif %}
        <a href="#reports">
            <i class="fas fa-file-medical"></i> Reports
        </a>
        <a href="#settings">
            <i class="fas fa-cog"></i> Settings
        </a>
    </div>
    
    <div class="navbar-user">
        <div class="user-profile">
            <img src="https://ui-avatars.com/api/?name={{ user_name }}&background=random" alt="User">
            <span>{{ user_name }}</span>
        </div>
        <a href="{{ url_for('logout') }}" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </a>
    </div>
</nav>

<main class="main-content">
    <div class="dashboard-header">
        <h1>Welcome, {{ user_name }}</h1>
        <p>{% if user_role == 'doctor' %}Doctor{% else %}Patient{% endif %} Dashboard</p>
    </div>
    
    {% if user_role == 'doctor' %}
    <div class="dashboard-section">
        <h2>Add New Patient</h2>
        <form class="patient-form" method="POST" action="{{ url_for('add_patient') }}">
            <div class="form-row">
                <input type="text" name="name" placeholder="Patient Name" required>
                <input type="number" name="age" placeholder="Age" required>
                <select name="gender" required>
                    <option value="" disabled selected>Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-row">
                <input type="text" name="condition" placeholder="Medical Condition" required>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-plus"></i> Add Patient
                </button>
            </div>
        </form>
    </div>
    
    <div class="dashboard-section">
        <h2>Your Patients</h2>
        <div class="patients-grid">
            {% for patient in patients %}
            <div class="patient-card">
                <div class="patient-avatar">
                    <img src="https://ui-avatars.com/api/?name={{ patient.name }}&background=random" alt="{{ patient.name }}">
                </div>
                <div class="patient-info">
                    <h3>{{ patient.name }}</h3>
                    <p><i class="fas fa-birthday-cake"></i> {{ patient.age }} years</p>
                    <p><i class="fas fa-venus-mars"></i> {{ patient.gender }}</p>
                    <p><i class="fas fa-disease"></i> {{ patient.condition }}</p>
                </div>
                <div class="patient-actions">
                    <button class="btn-icon"><i class="fas fa-notes-medical"></i></button>
                    <button class="btn-icon"><i class="fas fa-edit"></i></button>
                </div>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="fas fa-user-md"></i>
                <p>No patients added yet</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="dashboard-section">
        <h2>Update Your Health Profile</h2>
        <form class="health-form" method="POST" action="{{ url_for('update_health_profile') }}">
            <div class="form-row">
                <div class="form-group">
                    <label for="age">Age</label>
                    <input type="number" id="age" name="age" placeholder="Enter your age" value="{{ patient_data.age if patient_data }}" required>
                </div>
                <div class="form-group">
                    <label for="height">Height (cm)</label>
                    <input type="number" id="height" name="height" placeholder="Enter your height" value="{{ patient_data.height if patient_data }}" required>
                </div>
                <div class="form-group">
                    <label for="weight">Weight (kg)</label>
                    <input type="number" id="weight" name="weight" step="0.1" placeholder="Enter your weight" value="{{ patient_data.weight if patient_data }}" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="blood_type">Blood Type</label>
                    <select id="blood_type" name="blood_type" required>
                        <option value="" disabled selected>Select Blood Type</option>
                        <option value="A+" {% if patient_data and patient_data.blood_type == 'A+' %}selected{% endif %}>A+</option>
                        <option value="A-" {% if patient_data and patient_data.blood_type == 'A-' %}selected{% endif %}>A-</option>
                        <option value="B+" {% if patient_data and patient_data.blood_type == 'B+' %}selected{% endif %}>B+</option>
                        <option value="B-" {% if patient_data and patient_data.blood_type == 'B-' %}selected{% endif %}>B-</option>
                        <option value="AB+" {% if patient_data and patient_data.blood_type == 'AB+' %}selected{% endif %}>AB+</option>
                        <option value="AB-" {% if patient_data and patient_data.blood_type == 'AB-' %}selected{% endif %}>AB-</option>
                        <option value="O+" {% if patient_data and patient_data.blood_type == 'O+' %}selected{% endif %}>O+</option>
                        <option value="O-" {% if patient_data and patient_data.blood_type == 'O-' %}selected{% endif %}>O-</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="allergies">Allergies</label>
                    <input type="text" id="allergies" name="allergies" placeholder="List any allergies" value="{{ patient_data.allergies if patient_data }}">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group full-width">
                    <label for="medical_history">Medical History</label>
                    <textarea id="medical_history" name="medical_history" placeholder="Describe any past medical conditions or surgeries">{{ patient_data.medical_history if patient_data }}</textarea>
                </div>
            </div>
            
            <button type="submit" class="btn-primary">
                <i class="fas fa-save"></i> Update Profile
            </button>
        </form>
    </div>
    
    <div class="dashboard-section">
        <h2>Your Health Summary</h2>
        <div class="health-stats">
            <div class="stat-card">
                <i class="fas fa-heartbeat"></i>
                <h3>Heart Rate</h3>
                <p>{{ patient_stats.heart_rate if patient_stats else '--' }} bpm</p>
                <span class="stat-{{ 'good' if patient_stats and (60 <= patient_stats.heart_rate <= 100) else 'warning' }}">
                    {{ 'Normal' if patient_stats and (60 <= patient_stats.heart_rate <= 100) else 'Check' }}
                </span>
            </div>
            <div class="stat-card">
                <i class="fas fa-temperature-high"></i>
                <h3>Body Temp</h3>
                <p>{{ patient_stats.temperature if patient_stats else '--' }}Â°F</p>
                <span class="stat-{{ 'good' if patient_stats and (97 <= patient_stats.temperature <= 99) else 'warning' }}">
                    {{ 'Normal' if patient_stats and (97 <= patient_stats.temperature <= 99) else 'Check' }}
                </span>
            </div>
            <div class="stat-card">
                <i class="fas fa-weight"></i>
                <h3>BMI</h3>
                <p>{{ patient_stats.bmi if patient_stats else '--' }}</p>
                <span class="stat-{{ 'good' if patient_stats and (18.5 <= patient_stats.bmi <= 24.9) else 'warning' }}">
                    {{ 'Healthy' if patient_stats and (18.5 <= patient_stats.bmi <= 24.9) else 'Check' }}
                </span>
            </div>
            <div class="stat-card">
                <i class="fas fa-pills"></i>
                <h3>Medications</h3>
                <p>{{ patient_stats.medications if patient_stats else '0' }} Active</p>
                <a href="#" class="stat-link">View</a>
            </div>
        </div>
    </div>
    
    <div class="dashboard-section">
        <h2>Upcoming Appointments</h2>
        <div class="appointments-list">
            {% if appointments %}
                {% for appointment in appointments %}
                <div class="appointment-card">
                    <div class="appointment-date">
                        <span class="day">{{ appointment.date.strftime('%d') }}</span>
                        <span class="month">{{ appointment.date.strftime('%b').upper() }}</span>
                    </div>
                    <div class="appointment-info">
                        <h3>Dr. {{ appointment.doctor_name }}</h3>
                        <p><i class="fas fa-clock"></i> {{ appointment.time.strftime('%I:%M %p') }}</p>
                        <p><i class="fas fa-map-marker-alt"></i> {{ appointment.location }}</p>
                        <p><i class="fas fa-stethoscope"></i> {{ appointment.reason }}</p>
                    </div>
                    <div class="appointment-actions">
                        <button class="btn-outline">Reschedule</button>
                        <button class="btn-primary">Confirm</button>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-calendar-times"></i>
                    <p>No upcoming appointments</p>
                </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
</main>
{% endblock %}